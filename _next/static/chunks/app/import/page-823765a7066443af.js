(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{5293:(e,t,a)=>{Promise.resolve().then(a.bind(a,6740))},6740:(e,t,a)=>{"use strict";a.d(t,{default:()=>k});var s=a(5155),r=a(2115),l=a(8326),i=a(2039);a(9193);var n=a(3464),c=a(5424),x=a(5695),o=a(9988),d=a(6719),m=a(5110),h=a(2224),f=a(3571),p=a(9779),u=a(6806),w=a(4540),v=a(29),j=a(7654),N=a(4167);let g=function(){return(0,s.jsxs)("div",{className:"w-[300px] flex flex-col max-[600px]:my-3",children:[(0,s.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,s.jsxs)("ul",{className:"[&>li]:text-stone-400 list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,s.jsx)("li",{children:"此工具會根據玩家放在展示框的8個腳色身上的遺器做數據分析"}),(0,s.jsx)("li",{children:"翻盤機率是指說該遺器透過變量骰子後遺器分數變高的機率為何"}),(0,s.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等遺器"}),(0,s.jsx)("li",{children:"此工具相關數據仍有更改的可能，敬請見諒!"}),(0,s.jsx)("li",{children:"如果發現服務頻繁發生錯誤，暫時先使用simulator。"}),(0,s.jsxs)("li",{children:["詳細的操作說明可以參考",(0,s.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6065608",className:"!underline",children:"這篇"})]})]})]})};var b=a(4168),S=a(3789);let k=function(){let e="importData",[t,k]=(0,r.useState)(""),[D,I]=(0,r.useState)(),[y,R]=(0,r.useState)(),[A,E]=(0,r.useState)(0),[C,H]=(0,r.useState)(void 0),[O,_]=(0,r.useState)(void 0),[F,J]=(0,r.useState)(null),[L,B]=(0,r.useState)(void 0),[P,T]=(0,r.useState)([]),U=(0,r.useRef)(null),{showStatus:M,updateStatus:q,hideStatus:z}=(0,u.Z)(),G=(0,w.wA)(),Q=(0,w.d4)(e=>e.history.historyData),[V,W]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)([]),$=(0,r.useRef)([]),[K,X]=(0,r.useState)(!1),ee=(0,r.useRef)(!1),et=(0,x.usePathname)(),[ea,es]=(0,r.useState)(!0),[er,el]=(0,r.useState)(!1),ei=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function en(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s="http://localhost:3000"===window.location.origin?"http://localhost:5000/relic/get":"https://expressapi-o9du.onrender.com/relic/get";if(!e){if(!/^\d+$/.test(t)||!t)return void q("請輸入有效的UID!!","error");if(!D)return void q("未選擇任何腳色!!","error");if(!Y||0===Y.length)return void q("至少選擇一項加權!!","error");e={uid:t,charID:D,partsIndex:7}}a||(a=Y),el(!1),M("正在尋找匹配資料......","process"),es(!1),H(void 0),J(null),B(void 0),_(void 0),R(null),await n.A.post(s,e,{headers:{"Content-Type":"application/json"}}).then(async e=>{switch(e.data){case 800:q("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!","error"),es(!0);break;case 801:q("找不到該部件的遺器，如果是剛剛才更新的話建議等五分鐘再使用一次!!","error"),es(!0);break;case 802:q("該遺器等級尚未強化至滿等，請先強化至滿等後再嘗試!","error"),es(!0);break;case 803:q("該遺器非五星遺器，請選擇部位為五星強化滿等之遺器","error"),es(!0);break;case 804:q("該腳色並未穿著五星遺器！！","error"),es(!0);break;case 810:q("溝通次數太過於頻繁 請稍後再試!!","error"),es(!0);break;case 900:q("系統正在維護\n請稍後再試!","error"),es(!0);break;default:await ec(e.data,a)}}).catch(e=>{console.log(e),e.response&&429===e.response.status?q("請求次數過於頻繁\n請稍後再試!!","error"):q("系統正在維護中\n請稍後再試!!","error"),es(!0)})}(0,r.useEffect)(()=>{!function(){W(!1),G((0,v.eU)());let t=localStorage.getItem(e);if(null===t){q("尚未有任何操作紀錄!!","default"),W(!0);return}let a=JSON.parse(t);M("正在載入過往紀錄中.....","process"),a=a.filter(e=>"1.5"===e.version),localStorage.setItem(e,JSON.stringify(a)),null!=a&&a.length>0?(G((0,v.nS)(a)),q("先前紀錄已匯入!!","success")):q("尚未有任何操作紀錄","default"),W(!0)}()},[et]),(0,r.useEffect)(()=>{0!==P.length&&P[A].relic&&(R(P[A].relic),H(P[A].ExpRate),_(P[A].Rscore),B(P[A].PieNums),J(P[A].Rank),$.current=P[A].standDetails,es(!0))},[P,A]),(0,r.useEffect)(()=>{y&&requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[y]),(0,r.useEffect)(()=>{el(!1)},[D,t]);let ec=(0,r.useCallback)(async(e,t)=>{let s=[];for(let r of e){let e=await function(e,t){return new Promise(s=>{var r,l;let n=new Worker(a.tu(new URL(a.p+a.u(444),a.b))),c=i.A.find(t=>t.fieldName===e.main_affix.type),x=[];e.sub_affix.forEach((e,a)=>{let s=i.A.find(t=>t.fieldName===e.type),r=s.percent?Number((100*e.value).toFixed(1)):Number(e.value.toFixed(1)),l=t.find(e=>e.name===s.name),n={index:a,subaffix:s.name,data:r,count:e.count-1,stand:l?l.value:0,locked:!1};x.push(n)}),K&&(x.reduce((e,t)=>t.stand<e.stand?t:e).locked=!0);let o=x.some(e=>"速度"===e.subaffix)?.5*(null!=(l=null==(r=Y.find(e=>"速度"===e.name))?void 0:r.value)?l:0):0;x.forEach(e=>{"速度"!==e.subaffix&&0!==e.count&&(o+=.2)});let d={charID:D,MainData:c.name,SubData:x,partsIndex:e.type,standard:t,deviation:Number(o.toFixed(2))};M("數據計算處理中......","process"),n.postMessage(d),n.onmessage=function(a){s({relic:e,ExpRate:a.data.expRate,Rscore:a.data.relicscore,PieNums:a.data.returnData,Rank:a.data.relicrank,standDetails:t,affixLock:K})}})}(r,t);s.push(e)}E(0),T(s),el(!0),U.current=s,ee.current=K,q("資料顯示完畢","success")},[P,er,K]),ex=(0,r.useCallback)(e=>{let t=Q[e];ee.current=t.isLock,T([...t.dataArr]),E(0),el(!1),q("資料替換完畢!!","success"),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[Q]),eo=(0,r.useCallback)(async t=>{M("正在更新資料中......","process");let a=JSON.parse(JSON.stringify(Q))[t],s={uid:a.userID,charID:a.char.charID,partsIndex:7},r=a.dataArr[0].standDetails.map(e=>({...e}));await en(s,r).then(()=>{if(U.current){let s,r=0,l=0;U.current.forEach(e=>{r+=Number(e.Rscore),l+=Number(e.ExpRate)});let i=parseFloat((r/U.current.length).toFixed(1)),n=new Date,c=Number((100*l/U.current.length).toFixed(1));ei.forEach(e=>{e.stand<=i&&void 0===s&&(s=e)});let x={version:"1.5",calDate:n.toISOString().split("T")[0],userID:a.userID,char:a.char,dataArr:U.current,avgScore:i,avgRank:s,avgRate:c,isLock:a.isLock};G((0,v.Al)({index:t,newData:x})),q("已更新","success"),el(!1);let o=JSON.parse(JSON.stringify(Q));o[t]=x,localStorage.setItem(e,JSON.stringify(o))}}).catch(e=>{console.error("錯誤發生：",e),console.error("錯誤訊息：",e.message),console.error("堆疊追蹤：",e.stack)})},[Q]),ed=(0,r.useCallback)(t=>{if(!confirm("確定要刪除資料嗎?"))return;let a=Q;G((0,v.SB)(t)),a=a.filter((e,a)=>a!==t),localStorage.setItem(e,JSON.stringify(a)),setTimeout(()=>{q("成功刪除該筆資料","success")},0)},[Q]),em={charID:D,selfStand:Y,partsIndex:7,standDetails:$.current,partArr:["Head 頭部","Hand 手部","Body 軀幹","Feet 腳部","Ball 位面球","Rope 連結繩"],historyData:Q,isChangeAble:ea,RelicDataArr:P,affixLock:ee.current,isLoad:V,mode:"Importer",relicDataButton:!0,relic:y,Rscore:O,Rrank:F,ExpRate:C,PieNums:L,relicIndex:A,deleteHistoryData:ed,checkDetails:ex,updateDetails:eo,setCharID:I,setSelfStand:Z,setIsSaveAble:el,setRelicIndex:E,setRelic:R};return(0,s.jsxs)(p.A.Provider,{value:em,children:[(0,s.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[95%] rounded-md ",children:[(0,s.jsx)("div",{className:"rounded-md",children:(0,s.jsxs)("div",{className:"flex flex-row flex-wrap",children:[(0,s.jsxs)("div",{className:"flex flex-col w-2/5 bg-black/50 rounded-md max-[1250px]:w-full test",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center ml-2 mt-2",children:[(0,s.jsx)("h1",{className:"text-red-600 font-bold text-2xl",children:"自動匯入"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ImporterHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})}),(0,s.jsx)("div",{className:"relative ml-auto mr-3",onClick:()=>G((0,j.D1)()),children:(0,s.jsxs)("div",{className:"text-white underline cursor-pointer flex flex-row",children:[(0,s.jsx)("img",{src:"".concat("/StarRailApi","/image/breakingNews.svg"),alt:"icon"}),(0,s.jsx)("span",{children:"最新更新"})]})})]}),(0,s.jsxs)("div",{className:"flex flex-col px-2 rounded-md",children:[(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-stone-400",children:"玩家UID :"})}),(0,s.jsx)("input",{type:"text",placeholder:"HSR UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:e=>k(e.target.value),disabled:!ea})]}),(0,s.jsxs)("div",{className:"flex flex-row items-center [&>*]:mr-2 my-3 max-[400px]:!flex-col ",children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-stone-400 whitespace-nowrap",children:"Characters 腳色:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(f.zj,{}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-stone-400 whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,s.jsx)("div",{className:"flex flex-row items-center",children:(0,s.jsx)(f.mM,{})})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-stone-400 whitespace-nowrap",children:"Lock 是否鎖定:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)("button",{className:"rounded-sm px-2 font-bold text-black ".concat(K?"bg-amber-500":"bg-stone-500"),onClick:()=>X(e=>!e),children:K?"啟用":"不啟用"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"AffixLockHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-2 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===Y.length?"hidden":""),children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-stone-400",children:"Params 參數:"})}),(0,s.jsx)(m.Q,{})]}),(0,s.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[900px]:justify-center",children:[(0,s.jsx)(S.A,{text:"開始匹配",handler:()=>en(),disabled:!ea}),(0,s.jsx)(S.A,{text:"儲存紀錄",handler:()=>(function(){let a,s=l.A.find(e=>e.charID===D);if(Q.length>=6&&G((0,v._0)()),0===P.length)return void q("當前沒有任何數據，不予儲存!!","error");if(!t)return void q("沒有輸入玩家ID，請再試一次!!","error");if(!D)return void q("沒有選擇任何腳色!!","error");let r=0,i=0;P.forEach(e=>{r+=Number(e.Rscore),i+=Number(e.ExpRate)});let n=parseFloat((r/P.length).toFixed(1)),c=new Date,x=Number((100*i/P.length).toFixed(1));ei.forEach(e=>{e.stand<=n&&void 0===a&&(a=e)});let o={version:"1.5",calDate:c.toISOString().split("T")[0],userID:t,char:s,dataArr:P,avgScore:n,avgRank:a,avgRate:x,isLock:ee.current},d=JSON.parse(JSON.stringify(Q));G((0,v.Gs)(o)),d.push(o),q("已儲存","success"),el(!1),localStorage.setItem(e,JSON.stringify(d))})(),disabled:!er})]})]})]}),(0,s.jsxs)("div",{className:"w-[55%] pb-3 pt-1 h-fit flex-wrap max-[1250px]:w-full max-[1250px]:mb-5 ml-2 bg-black/50 rounded-md max-[1250px]:ml-0 max-[1250px]:mt-2",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center px-2 max-[600px]:justify-center",children:[(0,s.jsx)("span",{className:"text-red-600 text-lg font-bold",children:"過往紀錄"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-scroll p-2  hiddenScrollBar flex flex-row flex-wrap max-[600px]:!flex-col max-[600px]:!flex-nowrap max-[600px]:items-center",children:(0,s.jsx)(o.f,{})})]})]})}),L?(0,s.jsxs)("div",{className:"flex flex-row flex-wrap mt-2 w-full bg-black/50 shadowBox px-2 mb-5 rounded-md",children:[(0,s.jsx)("div",{className:"w-full max-[500px]:justify-center",children:(0,s.jsx)(f.aY,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/4  max-[700px]:w-[50%] max-[500px]:w-4/5 max-[500px]:mx-auto",children:(0,s.jsx)(h.G,{})}),(0,s.jsx)("div",{className:"mt-3 w-1/4 max-[700px]:w-[50%] max-[500px]:w-4/5 max-[500px]:mx-auto",children:(0,s.jsx)(m.V,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/2 max-[700px]:w-full max-[500px]:w-4/5 max-[500px]:mx-auto",id:"resultDetails",children:(0,s.jsx)(d.A,{})})]}):null]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.m_,{id:"CharHint",place:"right-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,s.jsx)("span",{className:"text-white",children:"例如:Jingliu→鏡流"})]})}),(0,s.jsx)(c.m_,{id:"HistoryHint",place:"top-start",render:()=>(0,s.jsx)(N.A,{})}),(0,s.jsx)(c.m_,{id:"RelicSelectHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有遺器"}),(0,s.jsx)("span",{children:"點選遺器即可查看個別資訊"}),(0,s.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等遺器遺器"})]})}),(0,s.jsx)(c.m_,{id:"ImporterHint",place:"right-start",render:()=>(0,s.jsx)(g,{}),clickable:!0}),(0,s.jsx)(c.m_,{id:"AffixLockHint",place:"right-start",render:()=>(0,s.jsx)(b.A,{}),style:{zIndex:10}})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8,935,388,994,874,899,329,911,441,684,358],()=>t(5293)),_N_E=e.O()}]);