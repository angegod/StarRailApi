(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{3489:(e,a,t)=>{"use strict";t.d(a,{default:()=>N});var s=t(5155),r=t(2115),l=t(2540),i=t(7665);t(9193);var n=t(3464),c=t(5424),o=t(5695),x=t(8637),d=t(7901),m=t(8390),h=t(1582),p=t(3848),u=t(9779),f=t(4422),w=t(4540),v=t(315),j=t(7525);let g=function(){return(0,s.jsxs)("div",{className:"w-[300px] flex flex-col max-[600px]:my-3",children:[(0,s.jsx)("h2",{className:"text-red-600 font-bold text-lg",children:"使用說明"}),(0,s.jsxs)("ul",{className:"[&>li]:text-white list-decimal [&>li]:ml-2 max-[400px]:[&>li]:text-sm",children:[(0,s.jsx)("li",{children:"此工具會根據玩家放在展示框的8個腳色身上的遺器做數據分析"}),(0,s.jsx)("li",{children:"翻盤機率是指說該遺器透過變量骰子後遺器分數變高的機率為何"}),(0,s.jsx)("li",{children:"目前該工具只支援計算五星強化至滿等遺器"}),(0,s.jsx)("li",{children:"此工具相關數據仍有更改的可能，敬請見諒!"}),(0,s.jsx)("li",{children:"如果發現服務頻繁發生錯誤，可以先使用simulator。"}),(0,s.jsxs)("li",{children:["操作說明可以參考",(0,s.jsx)("a",{href:"https://home.gamer.com.tw/artwork.php?sn=6065608",className:"!underline",children:"這篇"})]})]})]})},N=function(){let e="importData",a=(0,r.useRef)(""),[N,b]=(0,r.useState)(void 0),[S,D]=(0,r.useState)(),[I,k]=(0,r.useState)(0),[y,R]=(0,r.useState)(void 0),[A,E]=(0,r.useState)(void 0),[C,H]=(0,r.useState)({color:void 0,rank:void 0}),[O,_]=(0,r.useState)(void 0),[J,F]=(0,r.useState)([]),B=(0,r.useRef)(null),{showStatus:P,updateStatus:T,hideStatus:U}=(0,f.Z)(),M=(0,w.wA)(),q=(0,w.d4)(e=>e.history.historyData),[G,L]=(0,r.useState)(!1),[z,Q]=(0,r.useState)([]),V=(0,r.useRef)([]),W=(0,o.usePathname)(),[Y,Z]=(0,r.useState)(!0),[$,K]=(0,r.useState)(!1),X=[{rank:"S+",stand:85,color:"rgb(239, 68, 68)",tag:"S+"},{rank:"S",stand:70,color:"rgb(239, 68, 68)",tag:"S"},{rank:"A",stand:50,color:"rgb(234, 179, 8)",tag:"A"},{rank:"B",stand:35,color:"rgb(234, 88 , 12)",tag:"B"},{rank:"C",stand:15,color:"rgb(163, 230, 53)",tag:"C"},{rank:"D",stand:0,color:"rgb(22,163,74)",tag:"D"}];async function ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s="http://localhost:3000"===window.location.origin?"http://localhost:5000/relic/get":"https://expressapi-o9du.onrender.com/relic/get";if(!e){if(!/^\d+$/.test(a.current)||!a.current)return void T("請輸入有效的UID!!","error");if(!N)return void T("未選擇任何腳色!!","error");if(!z||0===z.length)return void T("至少選擇一項加權!!","error");e={uid:a.current,charID:N,partsIndex:7}}t||(t=z),K(!1),P("正在尋找匹配資料......","process"),Z(!1),R(void 0),H({color:void 0,rank:void 0}),_(void 0),E(void 0),D(),await n.A.post(s,e,{headers:{"Content-Type":"application/json"}}).then(async e=>{switch(e.data){case 800:T("找不到該腳色。必須要將腳色放在展示區才可以抓到資料!!","error"),Z(!0);break;case 801:T("找不到該部件的遺器，如果是剛剛才更新的話建議等五分鐘再使用一次!!","error"),Z(!0);break;case 802:T("該遺器等級尚未強化至滿等，請先強化至滿等後再嘗試!","error"),Z(!0);break;case 803:T("該遺器非五星遺器，請選擇部位為五星強化滿等之遺器","error"),Z(!0);break;case 804:T("該腳色並未穿著五星遺器！！","error"),Z(!0);break;case 810:T("溝通次數太過於頻繁 請稍後再試!!","error"),Z(!0);break;case 900:T("系統正在維護\n請稍後再試!","error"),Z(!0);break;default:await ea(e.data,t)}}).catch(e=>{console.log(e),e.response&&429===e.response.status?T("請求次數過於頻繁\n請稍後再試!!","error"):T("系統正在維護中\n請稍後再試!!","error"),Z(!0)})}(0,r.useEffect)(()=>{!function(){L(!1),M((0,v.eU)());let a=JSON.parse(localStorage.getItem(e));if(null===a){T("尚未有任何操作紀錄","default"),L(!0);return}P("正在載入過往紀錄中.....","process"),a=a.filter(e=>"1.4"===e.version),localStorage.setItem(e,JSON.stringify(a)),null!=a&&a.length>0?(M((0,v.nS)(a)),T("先前紀錄已匯入!!","success")):T("尚未有任何操作紀錄","default"),L(!0)}()},[W]),(0,r.useEffect)(()=>{0!==J.length&&(D(J[I].relic),R(J[I].ExpRate),E(J[I].Rscore),_(J[I].PieNums),H(J[I].Rank),V.current=J[I].standDetails,Z(!0))},[J,I]),(0,r.useEffect)(()=>{S&&requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[S]);let ea=(0,r.useCallback)(async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=[];for(let r of(a.forEach(e=>{if(""===e.value)return void T("加權指數不可為空或其他非法型式","error")}),e)){let e=await function(e,a){return new Promise(s=>{let r=new Worker(t.tu(new URL(t.p+t.u(587),t.b))),l=i.A.find(a=>a.fieldName===e.main_affix.type),n=[];e.sub_affix.forEach((e,a)=>{let t=i.A.find(a=>a.fieldName===e.type),s=t.percent?Number((100*e.value).toFixed(1)):Number(e.value.toFixed(1)),r={index:a,subaffix:t.name,data:s,count:e.count-1};n.push(r)});let c=n.includes(e=>"spd"===e.subaffix)?.5*z.find(e=>"速度"===e.name).value:0;n.forEach(e=>{"spd"!==e.subaffix&&0!==e.count&&(c+=.2)});let o={charID:N,MainData:l.name,SubData:n,partsIndex:e.type,standard:a,deviation:.5};P("數據計算處理中......","process"),r.postMessage(o),r.onmessage=function(t){s({relic:e,ExpRate:t.data.expRate,Rscore:t.data.relicscore,PieNums:t.data.returnData,Rank:t.data.relicrank,standDetails:a})}})}(r,a);s.push(e)}F(s),K(!0),B.current=s,T("資料顯示完畢","success")},[J,$]),et=(0,r.useCallback)(e=>{F([...q[e].dataArr]),k(0),K(!1),T("資料替換完畢!!","success"),requestAnimationFrame(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})},[q]),es=(0,r.useCallback)(async a=>{P("正在更新資料中......","process");let t=JSON.parse(JSON.stringify(q))[a],s={uid:t.userID,charID:t.char.charID,partsIndex:7},r=t.dataArr[0].standDetails.map(e=>({...e}));await ee(s,r).then(()=>{if(console.log(B.current),B.current){let s,r=0,l=0;B.current.forEach(e=>{r+=Number(e.Rscore),l+=e.ExpRate});let i=Number(parseFloat(r/B.current.length).toFixed(1)),n=new Date,c=Number((100*l/B.current.length).toFixed(1));X.forEach(e=>{e.stand<=i&&void 0===s&&(s=e)});let o={version:"1.4",calDate:n.toISOString().split("T")[0],userID:t.userID,char:t.char,dataArr:B.current,avgScore:i,avgRank:s,avgRate:c};M((0,v.Al)({index:a,newData:o})),T("已更新","success"),K(!1);let x=JSON.parse(JSON.stringify(q));x[a]=o,localStorage.setItem(e,JSON.stringify(x))}}).catch(e=>{console.error("錯誤發生：",e),console.error("錯誤訊息：",e.message),console.error("堆疊追蹤：",e.stack)})},[q]),er=(0,r.useCallback)(a=>{let t=q;console.log(a),M((0,v.SB)(a)),t=t.filter((e,t)=>t!==a),localStorage.setItem(e,JSON.stringify(t)),setTimeout(()=>{T("成功刪除該筆資料","success")},0)},[q]),el={charID:N,selfStand:z,partsIndex:7,standDetails:V.current,partArr:["Head 頭部","Hand 手部","Body 軀幹","Feet 腳部","Ball 位面球","Rope 連結繩"],historyData:q,isChangeAble:Y,RelicDataArr:J,isLoad:G,mode:"Importer",relic:S,Rscore:A,Rrank:C,ExpRate:y,PieNums:O,relicIndex:I,deleteHistoryData:er,checkDetails:et,updateDetails:es,setCharID:b,setSelfStand:Q,setIsSaveAble:K,setRelicIndex:k,setRelic:D};return(0,s.jsxs)(u.A.Provider,{value:el,children:[(0,s.jsxs)("div",{className:"flex flex-col w-4/5 mx-auto max-[600px]:w-[95%] rounded-md ",children:[(0,s.jsx)("div",{className:"rounded-md",children:(0,s.jsxs)("div",{className:"flex flex-row flex-wrap max-[600px]:w-[95%] ",children:[(0,s.jsxs)("div",{className:"flex flex-col w-2/5 bg-[rgba(0,0,0,0.5)] rounded-md max-[1250px]:w-[100%] test",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center ml-2 mt-2",children:[(0,s.jsx)("h1",{className:"text-red-600 font-bold text-2xl",children:"遺器匯入"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"ImporterHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsxs)("div",{className:"flex flex-col px-2 rounded-md",children:[(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"玩家UID :"})}),(0,s.jsx)("input",{type:"text",placeholder:"HSR UID",className:"h-[40px] max-w-[170px] pl-2    bg-inherit text-white outline-none border-b border-white",id:"userId",onChange:e=>a.current=e.target.value,disabled:!Y})]}),(0,s.jsxs)("div",{className:"flex flex-row [&>*]:mr-2 my-3 max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Characters 腳色:"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center",children:[(0,s.jsx)(p.zj,{}),(0,s.jsx)("div",{className:"hintIcon ml-1 overflow-visible","data-tooltip-id":"CharHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 [&>*]:mr-2 flex flex-row items-baseline max-[400px]:!flex-col",children:[(0,s.jsx)("div",{className:"text-right w-[200px]  max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white whitespace-nowrap",children:"Affix 有效詞條:"})}),(0,s.jsx)("div",{className:"flex flex-row items-center",children:(0,s.jsx)(p.mM,{})})]}),(0,s.jsxs)("div",{className:"mt-2 [&>*]:mr-2 flex flex-row max-[400px]:!flex-col ".concat(0===z.length?"hidden":""),children:[(0,s.jsx)("div",{className:"text-right w-[200px] max-[400px]:text-left max-[600px]:w-[120px]",children:(0,s.jsx)("span",{className:"text-white",children:"Params 參數:"})}),(0,s.jsx)(m.Q,{})]}),(0,s.jsxs)("div",{className:"my-3 flex flex-row [&>*]:mr-2 justify-end max-w-[400px] max-[900px]:justify-center",children:[(0,s.jsx)("button",{className:"processBtn",onClick:()=>ee(),disabled:!Y,children:"開始匹配"}),(0,s.jsx)("button",{className:"processBtn",onClick:()=>(function(){let t,s=l.A.find(e=>e.charID===N);if(q.length>=6&&M((0,v._0)()),0===J.length)return void T("當前沒有任何數據，不予儲存!!","error");if(!a.current)return void T("沒有輸入玩家ID，請再試一次!!","error");if(!N)return void T("沒有選擇任何腳色!!","error");let r=0,i=0;J.forEach(e=>{r+=Number(e.Rscore),i+=e.ExpRate});let n=Number(parseFloat(r/J.length).toFixed(1)),c=new Date,o=Number((100*i/J.length).toFixed(1));X.forEach(e=>{e.stand<=n&&void 0===t&&(t=e)});let x={version:"1.4",calDate:c.toISOString().split("T")[0],userID:a.current,char:s,dataArr:J,avgScore:n,avgRank:t,avgRate:o},d=JSON.parse(JSON.stringify(q));M((0,v.Gs)(x)),d.push(x),T("已儲存","success"),K(!1),localStorage.setItem(e,JSON.stringify(d))})(),disabled:!$,children:"儲存紀錄"})]})]})]}),(0,s.jsxs)("div",{className:"w-[55%] pb-3 pt-1 h-fit flex-wrap max-[1250px]:w-[100%] max-[1250px]:mb-5 ml-2 bg-[rgba(0,0,0,0.5)] rounded-md max-[1250px]:ml-0 max-[1250px]:mt-2",children:[(0,s.jsxs)("div",{className:"flex flex-row items-baseline px-2 max-[600px]:justify-center",children:[(0,s.jsx)("span",{className:"text-red-600 text-lg font-bold",children:"過往紀錄"}),(0,s.jsx)("div",{className:"hintIcon ml-2 overflow-visible","data-tooltip-id":"HistoryHint",children:(0,s.jsx)("span",{className:"text-white",children:"?"})})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-scroll p-2  hiddenScrollBar flex flex-row flex-wrap max-[600px]:!flex-col max-[600px]:!flex-nowrap max-[600px]:items-center",children:(0,s.jsx)(x.f,{})})]})]})}),(0,s.jsxs)("div",{className:"flex flex-row flex-wrap mt-2 w-[100%] ".concat(O?"":"hidden"," bg-[rgba(0,0,0,0.5)] shadowBox px-2 mb-5 rounded-md"),children:[(0,s.jsx)("div",{className:"w-[100%] ".concat(void 0===O?"hidden":""," max-[500px]:justify-center"),children:(0,s.jsx)(p.aY,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/4  max-[700px]:w-[50%] ".concat(O?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,s.jsx)(h.G,{mode:"Importer",button:!0})}),(0,s.jsx)("div",{className:"mt-3 w-1/4 max-[700px]:w-[50%] ".concat(O?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),children:(0,s.jsx)(m.V,{})}),(0,s.jsx)("div",{className:"mt-3 flex flex-row flex-wrap w-1/2 max-[700px]:w-[100%] ".concat(O?"":"hidden"," max-[500px]:w-4/5 max-[500px]:mx-auto"),id:"resultDetails",children:(0,s.jsx)(d.A,{})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.m_,{id:"CharHint",place:"right-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-white",children:"選擇指定腳色，可以使用中文或英文關鍵字"}),(0,s.jsx)("span",{className:"text-white",children:"例如:Jingliu→鏡流"})]})}),(0,s.jsx)(c.m_,{id:"HistoryHint",place:"top-center",render:()=>(0,s.jsx)(j.A,{})}),(0,s.jsx)(c.m_,{id:"RelicSelectHint",place:"top-start",render:()=>(0,s.jsxs)("div",{className:"flex flex-col [&>span]:text-white max-w-[250px] p-1",children:[(0,s.jsx)("span",{children:"下方會顯示出該腳色符合條件的所有遺器"}),(0,s.jsx)("span",{children:"點選遺器即可查看個別資訊"}),(0,s.jsx)("span",{className:"!text-red-600 font-bold",children:"僅顯示符合條件的五星滿等遺器遺器"})]})}),(0,s.jsx)(c.m_,{id:"ImporterHint",place:"right-start",render:()=>(0,s.jsx)(g,{}),clickable:!0})]})]})}},7493:(e,a,t)=>{Promise.resolve().then(t.bind(t,3489))}},e=>{var a=a=>e(e.s=a);e.O(0,[8,935,388,994,874,899,337,328,441,684,358],()=>a(7493)),_N_E=e.O()}]);